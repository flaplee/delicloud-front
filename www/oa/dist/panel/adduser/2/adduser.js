'use strict';define(['module','common/kernel/kernel','site/util/util','page/contacts/contacts'],function(a,b,c,d){var e=a.id.replace(/^[^/]+\/|\/[^/]+/g,''),f=$('#'+e),g=f.find('.add-user'),h=g.find('.add-inner'),j=h.find('.add-form .add-form-base'),k=h.find('.add-form .add-form-extra'),l=k.find('.extra-list'),i=h.find('.add-form-btn'),m=j.find('.btn-to-user'),n=h.find('.add-btns'),o=i.find('.btn-add-more'),p=n.find('.btn-add-user'),q=n.find('.btn-add-user-go'),r=n.find('.btn-add-cancel');return{onload:function onload(a){function f(a){a.find('a.btn-to-dept').on('click',function(a){a.stopPropagation();var d=$(this),c=d.parents('li.extra-item').index();b.openPopup('adddept',{type:'seldept',data:{index:c,org_id:v.orgid,parentid:t}})}),a.find('a.extra-item-del').on('click',function(a){a.stopPropagation();var b=$(this),c=b.parents('li.extra-item').index();b.parent('li.extra-item').remove()})}function e(a){var b=/^1[3,4,5,7,8]{1}[0-9]{9}$/;return b.test(a)}console.log('contacts',d);var n=c.getCookie('userid'),s=c.getCookie('token'),t=c.getCookie('parentid'),u=a.type,v=a.data;if(console.log('data.uid',v),u&&'edit'==u){v.departmentid==v.orgid?'':v.department;if(g.find('h4').text('\u7F16\u8F91\u6210\u5458'),j.find('.username').val($.trim(v.nickname)),j.find('.usermobile').attr('disabled','disabled').val($.trim(v.mobile)),j.find('.employee_num').val($.trim(v.employee_num)),v.departmentids&&0<v.departmentids.length){k.find('ul.extra-list >').remove();for(var w=0;w<v.departmentids.length;w++){var i=0==w?'extra-item-index':'',x=$('<li class="extra-item '+i+'">\t\t\t\t\t\t\t<a href="javascript:;" class="extra-item-del">\u5220\u9664</a>\t\t\t\t\t\t\t<div class="form-group">\t\t\t\t\t\t\t\t<label class="col-sm-2 control-label" for="formGroupInputDefault">\u90E8\u95E8:</label>\t\t\t\t\t\t\t\t<div class="col-sm-8">\t\t\t\t\t\t\t\t\t<input disabled class="form-control department'+w+'" name="department'+w+'" type="text" placeholder="'+v.departments[w]+'" value="'+v.departments[w]+'" require>\t\t\t\t\t\t\t\t\t<input disabled class="form-control departmentId'+w+'" name="departmentId'+w+'" value="'+v.departmentids[w]+'" type="hidden">\t\t\t\t\t\t\t\t\t<a class="btn-to-dept" href="javascript:;"></a>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="form-group">\t\t\t\t\t\t\t\t<label class="col-sm-2 control-label" for="formGroupInputDefault">\u804C\u52A1:</label>\t\t\t\t\t\t\t\t<div class="col-sm-8">\t\t\t\t\t\t\t\t\t<input class="form-control business business'+w+'" name="business'+w+'" type="text" placeholder="'+v.titles[w]+'" value="'+v.titles[w]+'" require>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</li>');k.find('ul.extra-list').append(x),f(x)}}m.hide(),q.hide()}else{var y=0<v.isParentid.length?v.isParentid:'';g.find('h4').text('\u6DFB\u52A0\u6210\u5458'),j.find('.username').val(''),j.find('.usermobile').attr('disabled',!1).val(''),j.find('.employee_num').val(''),k.find('ul.extra-list >').remove();var z=$('<li class="extra-item extra-item-index">\t\t\t\t\t<a href="javascript:;" style="display:none;" class="extra-item-del">\u5220\u9664</a>\t\t\t\t\t<div class="form-group">\t\t\t\t\t\t<label class="col-sm-2 control-label" for="formGroupInputDefault">\u90E8\u95E8:</label>\t\t\t\t\t\t<div class="col-sm-8">\t\t\t\t\t\t\t<input disabled class="form-control department0" name="department0" type="text" placeholder="" value="" require>\t\t\t\t\t\t\t<input disabled class="form-control departmentId0" name="departmentId0" value="" type="hidden">\t\t\t\t\t\t\t<a class="btn-to-dept" href="javascript:;"></a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="form-group">\t\t\t\t\t\t<label class="col-sm-2 control-label" for="formGroupInputDefault">\u804C\u52A1:</label>\t\t\t\t\t\t<div class="col-sm-8">\t\t\t\t\t\t\t<input class="form-control business business0" name="business0" type="text" placeholder="" value="" require>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</li>');k.find('ul.extra-list').append(z),k.find('.extra-item-index .department0').val(''),k.find('.extra-item-index .departmentId0').val(y),k.find('.extra-item-index .business0').val(''),m.hide(),q.show()}(function(a,d){a.off('click').on('click',function(a){a.stopPropagation();var e=$(this),c=e.parents('li.extra-item').index();b.openPopup('adddept',{type:'seldept',data:{index:c,org_id:d.orgid,parentid:d.parentid}})})})(l.find('li.extra-item a.btn-to-dept'),{orgid:v.orgid,parentid:t}),m.off('click').on('click',function(){b.openPopup('finduser',{type:'finduser',data:{orgid:v.orgid,orgname:v.orgname,parentid:t}})}),o.off('click').on('click',function(a){a.stopPropagation();var b=parseInt(k.find('ul.extra-list .extra-item').length),c=0==b?'extra-item-index':'',d=$('<li class="extra-item '+c+'">\t\t\t\t\t<a href="javascript:;" class="extra-item-del">\u5220\u9664</a>\t\t\t\t\t<div class="form-group">\t\t\t\t\t\t<label class="col-sm-2 control-label" for="formGroupInputDefault">\u90E8\u95E8:</label>\t\t\t\t\t\t<div class="col-sm-8">\t\t\t\t\t\t\t<input disabled class="form-control department'+b+'" name="department'+b+'" type="text" placeholder="" require>\t\t\t\t\t\t\t<input disabled class="form-control departmentId'+b+'" name="departmentId'+b+'" type="hidden">\t\t\t\t\t\t\t<a class="btn-to-dept" href="javascript:;"></a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="form-group">\t\t\t\t\t\t<label class="col-sm-2 control-label" for="formGroupInputDefault">\u804C\u52A1:</label>\t\t\t\t\t\t<div class="col-sm-8">\t\t\t\t\t\t\t<input class="form-control business business'+b+'" name="business'+b+'" type="text" placeholder="" require>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</li>');k.find('ul.extra-list').append(d),f(d)}),p.off('click').on('click',function(){var a=[],f=[],g={mobile_region:v.mobile_region,mobile:j.find('.usermobile').val(),nickname:j.find('.username').val(),employee_num:j.find('.employee_num').val()};k.find('ul.extra-list li.extra-item').each(function(b,c){f.push($(c).find('.form-group input.departmentId'+b+'').val()),a.push($(c).find('.form-group input.business'+b+'').val())}),g.titles=a,g.department_ids=0<f.length?f:v.parentids,u&&'edit'==u?g.user_id=v.userid&&0<v.userid.length?v.userid:h.attr('data-userid'):'',''==g.nickname?b.hint('\u8BF7\u8F93\u5165\u6210\u5458\u59D3\u540D','error'):e(g.mobile)?c.ajaxSubmit({url:'/v1.0/org/user'+(u&&'edit'==u?'/'+(v.userid&&0<v.userid.length?v.userid:h.attr('data-userid'))+'':''),dauth:n+' '+new Date().valueOf()+' '+b.buildDauth(n,s,new Date().valueOf()),data:g,success:function success(a){a&&0==a.code&&(r.trigger('click'),b.hint(a.msg||(u&&'edit'==u?'\u7F16\u8F91\u6210\u5458\u4FE1\u606F\u6210\u529F':'\u6DFB\u52A0\u6210\u5458\u6210\u529F'),3e3),d.initContacts($('#contacts .contacts-box .contacts-inner tbody.tbody'),{orgid:v.orgid,type:v.type,title:v.orgname}))}}):b.hint('\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u7801','error')}),q.off('click').on('click',function(){var a=[],f=[],g={mobile_region:v.mobile_region,mobile:j.find('.usermobile').val(),nickname:j.find('.username').val(),employee_num:j.find('.employee_num').val()};k.find('ul.extra-list li.extra-item').each(function(b,c){f.push($(c).find('.form-group input.departmentId').val()),a.push($(c).find('.form-group input.business').val())}),g.titles=a,g.department_ids=0<f.length?f:v.parentids,u&&'edit'==u?g.user_id=v.userid&&0<v.userid.length?v.userid:h.attr('data-userid'):'',''==g.nickname?b.hint('\u8BF7\u8F93\u5165\u6210\u5458\u59D3\u540D','error'):e(g.mobile)?c.ajaxSubmit({url:'/v1.0/org/user'+(u&&'edit'==u?'/'+(v.userid&&0<v.userid.length?v.userid:h.attr('data-userid'))+'':''),dauth:n+' '+new Date().valueOf()+' '+b.buildDauth(n,s,new Date().valueOf()),data:g,success:function success(a){a&&0==a.code&&(r.trigger('click'),b.hint(a.msg||(u&&'edit'==u?'\u7F16\u8F91\u6210\u5458\u4FE1\u606F\u6210\u529F':'\u6DFB\u52A0\u6210\u5458\u6210\u529F'),3e3),d.initContacts($('#contacts .contacts-box .contacts-inner tbody.tbody'),{orgid:v.orgid,type:v.type,title:v.orgname}))}}):b.hint('\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u7801','error')}),r.off('click').on('click',function(){b.closePanel('adduser')})},onunload:function onunload(){},onloadend:function onloadend(){},onunloadend:function onunloadend(){},ondestory:function ondestory(){}}});