'use strict';define(['common/kernel/kernel','site/util/util'],function(a,b){function c(c,d){var e=new Date().valueOf().toString();b.ajaxSubmit({type:'get',url:'/v1.0/admin/group/'+c.orgid+'',dauth:c.userid+' '+e+' '+a.buildDauth(c.userid,c.token,e),data:{},success:function success(b){if(0==b.code){var e=[];0<b.data.result.length&&$.each(b.data.result,function(a,b){$.each(b.admin_ids,function(a,b){e.push(b)})}),'function'==typeof d&&d(!!(0<=$.inArray(c.userid,e)))}else a.hint(b.msg)},error:function error(b){a.hint(b.msg)}})}function d(c,d){c.find('>').remove();var f=new Date().valueOf().toString();b.ajaxSubmit({type:'get',url:'/v1.0/app/bind/'+d.orgid,dauth:d.userid+' '+f+' '+a.buildDauth(d.userid,d.token,f),data:{},success:function success(a){var f=a.data.result,g=[],h=[],k='',l=0;if(0<f.length){c.find('>').remove();for(var o,p=0;p<f.length;p++)if(o=f[p].visibility,o&&(g=f[p].app,'y'==g.status)){var i=$('<div class="app-item" data-app_id="'+g.id+'" title="'+g.name+'">                                    <div class="item-icon-wrap">                                        <img class="item-icon" src="'+(g.icon?g.icon:'')+'">                                    </div>                                    <div class="item-title">'+g.name+'</div>                                    <div class="item-info"></div>                                </div>');switch(o){case 1:l++,c.append(i),e(i,g.web_url);break;case 2:for(var q=b.getUserData(),r=b.getCookie('orgindex'),s=q.organization[r].employees[0].department_code.split('_'),t=0;t<f[p].departments.length;t++)k+=f[p].departments[t].code;for(var n=0;n<s.length;n++)(0<k.indexOf(s[n])||k==s[n])&&(l++,c.append(i),e(i,g.web_url));break;case 3:for(var m=0;m<f[p].users.length;m++)h.push(f[p].users[m].id);0<=$.inArray(d.userid,h)&&(l++,c.append(i),e(i,g.web_url));break;default:;}}}if(0>=f.length||0==l){var j=$('<div class="empty empty-app"><div class="empty-item"><div class="empty-img empty-img-app"></div><p class="empty-text">\u6682\u65E0\u5E94\u7528</p></div></div>');c.append(j)}}})}function e(a,b){a.on('click',function(a){a.stopPropagation(),window.location.href=''+b+'?user_id='+f+'&org_id='+h+'&token='+g+'&uuid='})}var f,g,h,i,j,k,l,m,n=$('#appentry .app-box'),o=n.find('.app-main .app-installed .app-list.app-installed-list');return{onload:function onload(){if(f=b.getCookie('userid'),g=b.getCookie('token'),h=b.getCookie('orgid'),j=b.getCookie('orgname'),k=b.getCookie('parentid'),i=b.getCookie('orgindexadmin'),l=a.parseHash(location.hash),m=l.id,void 0===f||void 0===g||void 0===h)b.setUserData(void 0),a.replaceLocation({args:{},id:'loginhome'});else{var c={userid:f,token:g,parentid:k};if(h&&(c.orgid=h),'appentry'==m){var e=$('#header .user-head .nav-top .nav-item');e.find('a.navlink').removeClass('navlink-current'),e.find('a.navlink-group').hide(),e.find('a.navlink-user').show(),e.find('a.navlink-admin').hide(),e.find('a.navlink.entryBtn').addClass('navlink-current'),i&&'true'==i&&e.find('a.navlink-admin').show(),d(o,c)}}}}});