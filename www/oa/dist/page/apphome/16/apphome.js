'use strict';define(['common/kernel/kernel','site/util/util'],function(a,b){function c(c,e){c.find('>').remove();var f=new Date().valueOf().toString();b.ajaxSubmit({type:'get',url:'/v1.0/app/bind/'+e.orgid,dauth:e.userid+' '+f+' '+a.buildDauth(e.userid,e.token,f),data:{org_id:e.orgid},success:function success(a){var f=a.data.result,g=[],h=[],k=[];if(0<f.length)for(var l,o=0;o<f.length;o++)if(l=f[o].visibility,l&&(g=f[o].app,'y'==g.status)){var i=$('<div class="app-item" data-app_id="'+g.id+'" title="'+g.name+'">                                    <div class="item-icon-wrap">                                        <img class="item-icon" src="'+(g.icon?g.icon:'')+'">                                    </div>                                    <div class="item-title">'+g.name+'</div>                                    <div class="item-info"></div>                                </div>');switch(l){case 1:c.append(i),d(i,g.web_url);break;case 2:for(var p=b.getUserData(),q=b.getCookie('orgindex'),r=p.organization[q].employees[0].department_code.split('_'),s=0;s<f[o].departments.length;s++)k+=f[o].departments[s].code;for(var n=0;n<r.length;n++)(0<k.indexOf(r[n])||k==r[n])&&(c.append(i),d(i,g.web_url));break;case 3:for(var m=0;m<f[o].users.length;m++)h.push(f[o].users[m].id);0<=$.inArray(e.userid,h)&&(c.append(i),d(i,g.web_url));break;default:;}}c.append('<a class="app-item app-item-add '+(8<=g.length&&0==(g.length+1)%4?'app-item-radius-right':8<=g.length&&0==g.length%4?'app-item-radius-left':'')+'" href="/oa/#!app" title="\u5B89\u88C5\u65B0\u5E94\u7528">\t\t\t\t\t<div class="item-icon-wrap"></div>\t\t\t\t\t<div class="item-title">\u5B89\u88C5\u65B0\u5E94\u7528</div>\t\t\t\t\t<div class="item-info"></div>\t\t\t\t</a>')}})}function d(a,b){a.on('click',function(a){a.stopPropagation(),window.location.href=''+b+'?user_id='+f+'&org_id='+h+'&token='+g+'&uuid='})}var f,g,h,e,i,j,k,l=$('#apphome .app-box'),m=l.find('.app-main .app-installed .app-list.app-installed-list');return{onload:function onload(){if(f=b.getCookie('userid'),g=b.getCookie('token'),h=b.getCookie('orgid'),e=b.getCookie('orgname'),i=b.getCookie('parentid'),j=a.parseHash(location.hash),k=j.id,void 0===f||void 0===g||void 0===h)b.setUserData(void 0),a.replaceLocation({args:{},id:'loginhome'});else{var d={userid:f,token:g,parentid:i};if(h&&(d.orgid=h),'apphome'==k){var l=$('#header .user-head .nav-top .nav-item');l.find('a.navlink').removeClass('navlink-current'),l.find('a.navlink-group').show(),l.find('a.navlink-user').hide(),l.find('a.navlink-admin').hide(),l.find('a.navlink.appBtn').addClass('navlink-current'),c(m,d)}}}}});