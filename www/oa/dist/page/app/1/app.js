'use strict';define(['common/kernel/kernel','site/util/util'],function(a,b){function c(c){c.find('>').remove(),b.ajaxSubmit({type:'get',url:'/v1.0/app',dauth:e+' '+new Date().valueOf()+' '+a.buildDauth(e,f,new Date().valueOf()),data:{org_id:g},success:function success(a){console.log('res',a);for(var b=a.data.result,e=0;e<b.length;e++){var f='',g='';switch(g=!0==b[e].installed?'<a data-appid="'+b[e].id+'" class="btn btn-default btn-uninstall" title="\u5DF2\u5B89\u88C5" href="javascript:;">\u5DF2\u5B89\u88C5</a>':'<a data-appid="'+b[e].id+'" class="btn btn-info btn-install" title="\u5B89\u88C5" href="javascript:;">\u5B89\u88C5</a>',b[e].belong_type){case'group':f='<span class="item-category-name">\u56E2\u961F\u53EF\u7528</span>';break;case'user':f='<span class="item-category-name">\u4E2A\u4EBA\u53EF\u7528</span>';break;case'both':f='<span class="item-category-name">\u56E2\u961F\u53EF\u7528</span><span class="item-category-name">\u4E2A\u4EBA\u53EF\u7528</span>';}var h=$('<li class="item">                        <div class="item-wrap clear">    \t\t\t\t\t\t<div class="item-img" title="'+b[e].name+'">                                <img  src="'+b[e].icon+'" width="80" height="80" />    \t\t\t\t\t\t</div>    \t\t\t\t\t\t<div class="item-info">                                <div class="item-title clear">                                    <div class="item-text">'+b[e].name+'</div>                                    <div class="item-category">'+f+'</div>                                </div>                                <div class="item-content">'+b[e].slogan+'</div>    \t\t\t\t\t\t</div>                        </div>\t\t\t\t\t\t<div class="item-btn">\t\t\t\t\t\t\t'+g+'\t\t\t\t\t\t</div>\t\t\t\t\t</li>');c.append(h),d(h.find('.btn-install'),c,{appid:b[e].id})}}})}function d(d,h,i){d.on('click',function(){b.ajaxSubmit({type:'post',url:'/v1.0/bind/bind',dauth:e+' '+new Date().valueOf()+' '+a.buildDauth(e,f,new Date().valueOf()),data:{org_id:g,app_id:i.appid},success:function success(d){console.log('res',d),0==d.code&&(a.hint('\u5E94\u7528\u5B89\u88C5\u6210\u529F~','success'),b.setCookie('app_ids',parseInt(b.getCookie('app_ids'))+1),c(h))}})})}var e,f,g,h,i,j,k,l=$('#app .app-box'),m=l.find('.app-main .app-inner .app-main-list'),n=l.find('.btn-app-back');return n.on('click',function(){window.history.back()}),{onload:function onload(){if(e=b.getCookie('userid'),f=b.getCookie('token'),g=b.getCookie('orgid'),h=b.getCookie('orgname'),i=b.getCookie('parentid'),j=b.clone(a.location),k=j.id,void 0===e||void 0===f||void 0===g)b.setUserData(void 0),a.replaceLocation({args:{},id:'loginhome'});else{if('app'==k){var d=$('#header .user-head .nav-top .nav-item');d.find('a.navlink').removeClass('navlink-current'),d.find('a.navlink.appBtn').addClass('navlink-current')}c(m)}}}});