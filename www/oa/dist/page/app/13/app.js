'use strict';define(['common/kernel/kernel','site/util/util'],function(a,b){var c,d,e,f,g,h,i,j,k=$('#app .app-box'),l=k.find('.app-main .app-inner .app-main-list'),m=k.find('.btn-app-back');return m.on('click',function(){window.history.back()}),{onload:function onload(){function k(f,g){f.find('>').remove();var h=new Date().valueOf().toString();b.ajaxSubmit({type:'get',url:'/v1.0/app',dauth:c+' '+h+' '+a.buildDauth(c,d,h),data:{org_id:e},success:function success(a){for(var b=a.data.result,c=0;c<b.length;c++)if('y'==b[c].status){var d='',e='';switch(e=!0==b[c].installed?'<a data-appid="'+b[c].id+'" class="btn btn-default btn-uninstall" title="\u5DF2\u5B89\u88C5" href="javascript:;">\u5DF2\u5B89\u88C5</a>':'<a data-appid="'+b[c].id+'" class="btn btn-info btn-install" title="\u5B89\u88C5" href="javascript:;">\u5B89\u88C5</a>',b[c].belong_type){case'group':d='<span class="item-category-name">\u56E2\u961F\u53EF\u7528</span>';break;case'user':d='<span class="item-category-name">\u4E2A\u4EBA\u53EF\u7528</span>';break;case'both':d='<span class="item-category-name">\u56E2\u961F\u53EF\u7528</span><span class="item-category-name">\u4E2A\u4EBA\u53EF\u7528</span>';}var h=$('<li class="item">                                    <div class="item-wrap clear">                                        <div class="item-img" title="'+b[c].name+'">                                            <img  src="'+b[c].icon+'" width="80" height="80" />                                        </div>                                        <div class="item-info">                                            <div class="item-title clear">                                                <div class="item-text">'+b[c].name+'</div>                                                <div class="item-category">'+d+'</div>                                            </div>                                            <div class="item-content">'+b[c].slogan+'</div>                                        </div>                                    </div>                                    <div class="item-btn">                                        '+e+'                                    </div>                                </li>');f.append(h),m(h.find('.btn-install'),f,{appid:b[c].id,type:b[c].belong_type,orgtype:g})}}})}function m(f,g,h){f.on('click',function(){var f=new Date().valueOf().toString();'group'==h.orgtype&&'group'==h.type||'user'==h.orgtype&&'user'==h.type||'both'==h.type?b.ajaxSubmit({type:'post',url:'/v1.0/bind/bind',dauth:c+' '+f+' '+a.buildDauth(c,d,f),data:{org_id:e,app_id:h.appid},success:function success(c){0==c.code&&(a.hint('\u5E94\u7528\u5B89\u88C5\u6210\u529F','success'),b.setCookie('app_ids',parseInt(b.getCookie('app_ids'))+1),k(g))}}):('group'==h.orgtype&&a.hint('\u4F01\u4E1A\u7EC4\u7EC7\u65E0\u6CD5\u6DFB\u52A0\u4E2A\u4EBA\u5E94\u7528','info'),'user'==h.orgtype&&a.hint('\u4E2A\u4EBA\u7EC4\u7EC7\u65E0\u6CD5\u6DFB\u52A0\u4F01\u4E1A\u5E94\u7528','info'))})}if(c=b.getCookie('userid'),d=b.getCookie('token'),e=b.getCookie('orgid'),f=b.getCookie('orgname'),g=b.getCookie('orgtype'),h=b.getCookie('parentid'),i=b.clone(a.location),j=i.id,void 0===c||void 0===d||void 0===e)b.setUserData(void 0),a.replaceLocation({args:{},id:'loginhome'});else{if('app'==j){var n=$('#header .user-head .nav-top .nav-item');n.find('a.navlink').removeClass('navlink-current'),n.find('a.navlink-group').show(),n.find('a.navlink-user').hide(),n.find('a.navlink-admin').hide(),n.find('a.navlink.appBtn').addClass('navlink-current')}k(l,g)}}}});