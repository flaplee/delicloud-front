'use strict';define(['common/kernel/kernel','site/util/util','page/imports/member','common/text/text!page/imports/steps.html!strip'],function(a,b,c,d){var e,f,g=a.parseHash(location.hash),h=b.getCookie('userid'),i=b.getCookie('token'),j=b.getCookie('orgid'),k=!1;return c(function(){function c(c){a.showLoading();var d=new Date().valueOf().toString();return $.ajaxFileUpload({url:'/web/v1.0/import/employee',secureuri:!1,fileElementId:'upload-file',dataType:'json',beforeSend:function beforeSend(b){b.setRequestHeader('dauth',h+' '+d+' '+a.buildDauth(h,i,d))},data:{org_id:c,admin_id:h},success:function success(c){a.hideLoading(),$('#upload-file').val('');var d=$.parseJSON(jQuery(c).text());0==d.code?(e=d.data.result.success_list,f=d.data.result.fail_list,k=!0,B.find('span.nav-enable-num').text(e.length),C.find('span.nav-unable-num').text(f.length),0<e.length?(b.setCookie('employee_count',parseInt(b.getCookie('employee_count'))+e.length),a.hint('\u6210\u5458\u5BFC\u5165\u6210\u529F~'),g.args.type='steps',g.args.status='success'):(a.hint('\u90E8\u5206\u6210\u5458\u5BFC\u5165\u5931\u8D25~','error'),g.args.type='steps',g.args.status='error'),l(D,'enable',e),l(E,'unable',f),setTimeout(function(){g.args.type='steps',g.args.status='data',g.args.imports=0<e.length?'enable':'unable',a.replaceLocation(g)},1e3)):(k=!1,g.args.type='steps',g.args.status='error',a.hint(d.msg,'error'),setTimeout(function(){g.args.type='steps',g.args.status='data',g.args.imports='unable',a.replaceLocation(g)},1e3)),a.replaceLocation(g)},error:function error(c){a.hideLoading(),$('#upload-file').val('');var d=$.parseJSON(jQuery(c.responseText).text());0==d.code?(e=d.data.result.success_list,f=d.data.result.fail_list,k=!0,B.find('span.nav-enable-num').text(e.length),C.find('span.nav-unable-num').text(f.length),0<e.length?(b.setCookie('employee_count',parseInt(b.getCookie('employee_count'))+e.length),a.hint('\u6210\u5458\u5BFC\u5165\u6210\u529F~'),g.args.type='steps',g.args.status='success'):(a.hint('\u90E8\u5206\u6210\u5458\u5BFC\u5165\u5931\u8D25~','error'),g.args.type='steps',g.args.status='error'),l(D,'enable',e),l(E,'unable',f),setTimeout(function(){g.args.type='steps',g.args.status='data',g.args.imports=0<e.length?'enable':'unable',a.replaceLocation(g)},1e3)):(k=!1,g.args.type='steps',g.args.status='error',a.hint(d.msg,'error'),'9103101'==d.code?(s.find('p.user-error-title').hide(),s.find('p.authority-error-title').show()):(s.find('p.user-error-title').show(),s.find('p.authority-error-title').hide())),a.replaceLocation(g)}}),!1}function l(a,b,c){if(a.find('>').remove(),c&&0<c.length){var d='';$.each(c,function(a){d+='<tr>                        <td class="user-index">'+(a+1)+'</td>                        <td class="user-name">'+c[a].name+'</td>                        <td class="user-employeenum">'+c[a].employee_num+'</td>                        <td class="user-deptname" title="'+c[a].dept_name+'">'+c[a].dept_name+'</td>                        <td class="user-title" title="'+c[a].title+'">'+c[a].title+'</td>                        <td class="user-mobile">'+c[a].mobile+'</td>                        '+(b&&'unable'==b?'<td class="user-error"><span class="red">\u901A\u8BAF\u5F55\u4E2D\u5DF2\u5B58\u5728\u8BE5\u624B\u673A\u53F7\u7801\u7684\u5458\u5DE5</span></td>':'')+'                    </tr>'}),a.append(d)}}var m=$(d),n=$('#imports .imports-box'),o=n.find('.imports-info'),p=o.find('.imports-crumbs'),q=p.find('.imports-crumbs-user'),r=p.find('.imports-crumbs-info'),s=o.find('.imports-inner'),t=m.find('.btn-step-download'),u=m.find('.btn-step-upload'),v=m.find('#upload-form'),w=m.find('#upload-file');n.append(m);var x=n.find('.imports-steps'),y=s.find('.imports-inner-data .imports-nav a'),z=s.find('.imports-inner-data .imports-table'),A=s.find('.imports-upload button.btn-upload'),B=s.find('.imports-nav a.nav-enable'),C=s.find('.imports-nav a.nav-unable'),D=s.find('.imports-inner-data .imports-table .imports-table-enable .table-data-wrap table.table-data tbody.tbody'),E=s.find('.imports-inner-data .imports-table .imports-table-unable .table-data-wrap table.table-data tbody.tbody');y.on('click',function(b){b.stopPropagation();var d=$(this),c=d.index();d.hasClass('active')||(d.addClass('active').siblings().removeClass('active'),z.find('div').eq(c).addClass('active').siblings().removeClass('active')),g.args.imports=0==c?'enable':'unable',a.replaceLocation(g)}),v.on('change','#upload-file',function(){c(j)}),q.on('click',function(){g.args.type='info',g.args.status='data',a.replaceLocation(g)}),r.on('click',function(){g.args.type='steps',g.args.status='data',a.replaceLocation(g)}),A.on('click',function(b){b.stopPropagation(),$('#upload-file').val(''),g.args.type='info',g.args.status='data',g.args.imports='unable',a.replaceLocation(g)})}),function(){k&&!0==k&&($importsInfo.show(),$importsSteps.hide())}});