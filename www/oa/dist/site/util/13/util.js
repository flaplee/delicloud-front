"use strict";define(["common/kernel/kernel"],function(a){function c(){var c=b.clone(a.location);c.args.p=this.firstChild.data,location.assign(a.buildHash(c))}var b={ajaxSubmit:function(c){var d,f,g,h,i;if(window.XMLHttpRequest)d=new XMLHttpRequest;else if(window.ActiveXObject)try{d=new ActiveXObject("MSXML2.XMLHTTP")}catch(e){d=new ActiveXObject("Microsoft.XMLHTTP")}if(f=c.type||"post",g=c.force?c.url:"/web"+c.url,"get"===f&&c.data){h=[];for(i in c.data)c.data.hasOwnProperty(i)&&h.push(i+"="+c.data[i]);g=g+"?"+h.join("&")}d.open(f,g,!0),c.data||(c.data={}),d.onreadystatechange=function(){var e;if(4===d.readyState){if(200===d.status){try{e=JSON.parse(d.responseText)}catch(f){}e?0==e.code?"function"==typeof c.success&&c.success(e):("function"==typeof c.error?c.error(e):c.silent||a.hint(e.msg,"error"),501==e.code&&(b.setUserData(void 0),a.replaceLocation({args:{},id:"loginhome"}))):"function"==typeof c.error?c.error(d,"parse_error"):c.silent||a.hint("数据解析失败: "+d.responseText,"error")}else"function"==typeof c.error?c.error(d,"network_error"):c.silent||a.hint("网络异常，请稍后再试","error");"function"==typeof c.complete&&c.complete(d),c.silent||a.hideLoading()}},(window.FormData?c.data instanceof FormData:!1)?(c.dauth&&(d.setRequestHeader("Duagent","_web"),d.setRequestHeader("Dauth",c.dauth),d.setRequestHeader("Duagent","_web")),d.send(c.data)):(d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("If-Modified-Since","0"),d.setRequestHeader("Cache-Control","no-cache"),c.dauth&&(d.setRequestHeader("Dauth",c.dauth),d.setRequestHeader("Duagent","_web")),d.send(JSON.stringify(c.data))),c.silent||a.showLoading()},formatDate:function(a){if(0>=a)return"";var b,c,d,e;return b=new Date(1e3*a),c=b.getFullYear(),d=b.getMonth()+1,10>d&&(d="0"+d),e=b.getDate(),10>e&&(e="0"+e),c+"-"+d+"-"+e},formatTime:function(a){if(0>=a)return"";var b,c,d,e,f,g,h;return b=new Date(1e3*a),c=b.getFullYear(),d=b.getMonth()+1,10>d&&(d="0"+d),e=b.getDate(),10>e&&(e="0"+e),f=b.getHours(),10>f&&(f="0"+f),g=b.getMinutes(),10>g&&(g="0"+g),h=b.getSeconds(),10>h&&(h="0"+h),c+"-"+d+"-"+e+" "+f+":"+g+":"+h},setImgCat:function(a,b){var f,g,h,i,c=[],d=[],e=[];for(f in a)a.hasOwnProperty(f)&&/_img$/.test(f)&&1==b[f]["get"]&&(c.push(a[f]),e.push(b[f]["title"]));for(g=0;g<c.length;g++)for(h=c[g].split(","),i=0;i<h.length;i++)d.push({src:h[i],title:e[g]});return d},setFormData:function(a,b,c){var d,e;for(d in b)if(b.hasOwnProperty(d)&&(a.find("."+d+" input, ."+d+" select").prop("required",!!b[d].required),"[object Object]"===b[d].stype.toString())){a.find("."+d+" .select").html("");for(e in b[d].stype)a.find("."+d+" .select").append('<option value="'+e+'">'+b[d].stype[e]+"</option>")}if(c)for(d in b)b.hasOwnProperty(d)&&a.find("."+d+" input, ."+d+" select, ."+d+" textarea").val(c[d])},getFormData:function(a,b){var c,d,e,f={};for(c in b)if(b.hasOwnProperty(c)&&!a.find("."+c+" input, ."+c+" textarea, ."+c+" select").is(":hidden")&&(e=a.find("."+c+" input, ."+c+" textarea").val(),f[c]=void 0===e?"":e,"[object Object]"===b[c].stype.toString()))for(d in b[c].stype)f[c]=a.find("."+c+" input, ."+c+" select").val();return f},formatTimeDiff:function(a,b){var c,d,e,f=[Math.floor(a/86400),Math.floor(a/3600)%24,Math.floor(a/60)%60,Math.floor(a)%60];if(b){for(e=["天","小时","分钟","秒"],c=0;c<f.length;c++)if(f[c]>0)return f[c]+e[c];return"刚才"}for(e=["天","时","分","秒"],d=!1,c=0;c<f.length;c++)d?f[c]+=e[c]:f[c]>0?(f[c]=f[c]+e[c],d=!0):f[c]="";return f.join("")},isNullObj:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},setDisabledClass:function(a,b){b?a.addClass("disabled"):a.removeClass("disabled")},setCookie:function(a,b,c){var e,d=new Date;d.setDate(d.getDate()+c),e=escape(b)+"; path=/"+(null==c?"":"; expires="+d.toUTCString()),document.cookie=a+"="+e},getCookie:function(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return unescape(d)},delCookie:function(a){var b=this.getCookie(a);null!=b&&this.setCookie(a,b,-9)},clone:function(a){var c,d=$.type(a);if("date"===d)c=new Date(a.valueOf());else if("regexp"===d)d="",a.ignoreCase&&(d+="i"),a.multiline&&(d+="m"),a.global&&(d+="g"),a.sticky&&(d+="y"),a.unicode&&(d+="u"),c=RegExp(a.source,d);else if("error"===d)c="RangeError"===a.name?RangeError(a.message):"ReferenceError"===a.name?ReferenceError(a.message):"SyntaxError"===a.name?SyntaxError(a.message):"TypeError"===a.name?TypeError(a.message):"URIError"===a.name?URIError(a.message):Error(a.message);else if("array"===d)for(c=[],d=0;d<a.length;d++)c[d]=b.clone(a[d]);else if("object"===d){c={};for(d in a)c[d]=b.clone(a[d])}else c=a;return c},isEqual:function(a,c){var e,d=$.type(a);if(d===$.type(c)){if("object"===d){if(Object.keys(a).length===Object.keys(c).length){for(e in a)if(!(e in c&&b.isEqual(a[e],c[e])))return!1;return!0}return!1}if("array"===d){if(a.length===c.length){for(e=0;e<a.length;e++)if(!b.isEqual(a[e],c[e]))return!1;return!0}return!1}return"regexp"===d?a.source===c.source&&a.global===c.global&&a.ignoreCase===c.ignoreCase&&a.multiline===c.multiline&&a.sticky===c.sticky&&a.unicode===c.unicode:"error"===d?a.message=c.message&&a.name===c.name:"date"===d?a.valueOf()===c.valueOf():a===c}return!1},paging:function(d,e,f,g){var h,i,j,k,l,m,n,o,p;if(f>g){for(d.find(".item").remove(),d.find("a").off("click"),d.find(".listnum").text(f),h=Math.ceil(f/g),i=d.find(".first"),j=d.find(".last"),k=d.find(".previous"),l=d.find(".next"),1==e?(i.addClass("disabled"),k.addClass("disabled")):(i.removeClass("disabled"),i.on("click",function(){var c=b.clone(a.location);c.args.p=1,location.assign(a.buildHash(c))}),k.removeClass("disabled"),k.on("click",function(){var c=b.clone(a.location);c.args.p=e-1,location.assign(a.buildHash(c))})),e==h?(j.addClass("disabled"),l.addClass("disabled")):(j.removeClass("disabled"),j.on("click",function(){var c=b.clone(a.location);c.args.p=h,location.assign(a.buildHash(c))}),l.removeClass("disabled"),l.on("click",function(){var c=b.clone(a.location);c.args.p=e+1,location.assign(a.buildHash(c))})),o=Math.max(e-5,1),n=Math.min(e+4,h);9>n-o&&(o>1||h>n);)o>1?o--:n++;for(m=o;n>=m;m++)p=$('<a href="javascript:;" class="item">'+m+"</a>"),m==e&&p.addClass("active"),p.on("click",c),l.before(p);d.css("display","")}else d.css("display","none")}};return!function(){var c;b.setUserData=function(a,d){a!==c&&((a&&c?c.data?c.data.id?0:1:1:1)?(c=a,b.userEvents.onstatechange instanceof Function&&b.userEvents.onstatechange({type:"statechange",initiative:d,data:b.clone(a)})):b.isEqual(c,a)||(a.orgindex==c.orgindex?(c=a,b.userEvents.ondatachange instanceof Function&&b.userEvents.ondatachange({type:"datachange",initiative:d,data:b.clone(a)})):(c=a,b.userEvents.onpagechange instanceof Function&&b.userEvents.onpagechange({type:"pagechange",initiative:d,data:b.clone(a)}))))},b.getUserData=function(){return b.clone(c)},b.setToken=function(a){b.token!==a&&(b.token=a,b.setCookie("token",a),"function"==typeof b.userEvents.onstatechange&&b.userEvents.onstatechange({type:"statechange"}))},b.updateUserData=function(d,e,f){if("undefined"!=typeof d){var g=(new Date).valueOf().toString();b.ajaxSubmit({type:"get",url:"/v1.0/user/me",dauth:d+" "+g+" "+a.buildDauth(d,e,g),silent:!0,complete:function(a){var e,h,i;try{e=$.parseJSON(a.responseText),e.data&&(h=e.data.organization,i={data:e.data.result,organization:h},i.orgindex=b.getCookie("orgindex")||0,i.orgindexid=b.getCookie("orgindexid")||"",i.orgindexadmin=b.getCookie("orgindexadmin")||!1,b.setUserData(i))}catch(j){}"function"==typeof f&&f(b.clone(c))}})}else"function"==typeof f&&f(b.clone(c))},b.token=b.getCookie("token"),b.userEvents={}}(),!function(){function a(a,b){var c;for(c in a)"checkbox"===a[c].type?b[c]=b[c]?b[c].split(","):a[c].des?a[c].des.split(","):[]:"select"===a[c].type?b[c]in a[c].stype||(b[c]=a[c].des||Object.keys(a[c].stype)[0]):(void 0===b[c]||null===b[c])&&(b[c]=a[c].des)}b.setDefaultValue=function(b){var c,d;if(b.attributes){b.list||(b.list={});for(c in b.attributes)if(b.list[c]||(b.list[c]={}),"array"===$.type(b.list[c]))for(d=0;d<b.list[c].length;d++)a(b.attributes[c],b.list[c][d]);else a(b.attributes[c],b.list[c])}},b.getCheckboxValue=function(a,b){var c,d=[],e=a.find("input[type=checkbox]"+(b?b:"")+":enabled:checked");for(c=0;c<e.length;c++)d.push(e[c].value);return d.join(",")},b.setCheckboxValue=function(a,b,c){var d,e=a.find("input[type=checkbox]"+(b?b:""));for(d=0;d<e.length;d++)e[d].checked=c.indexOf(e[d].value)>=0},b.getRadioValue=function(a,b){return a.find("input[type=radio][name="+b+"]:enabled:checked").val()},b.setRadioValue=function(a,b,c){a.find("input[type=radio][name="+b+"][value="+c+"]").prop("checked",!0)},b.getInputValue=function(a,b){return a.find(b+":enabled").val()},b.makeOptions=function(a){var b,c="";for(b in a)c+='<option value="'+b+'">'+a[b]+"</option>";return c},b.setUrlPort=function(a){var b=location.protocol,c=location.host;return b+"//"+c+":"+a}}(),b});