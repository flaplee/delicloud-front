'use strict';define(['module','common/kernel/kernel','site/util/util'],function(a,b,c){var d,f,e=a.id.replace(/^[^/]+\/|\/[^/]+/g,''),g=$('#'+e),h=g.find('.search-form'),i=h.find('.search-box'),j=i.find('input.search'),k=h.find('a.btn-user-search'),l=g.find('.btn-find-user-end'),m=g.find('.btn-find-user-cancel'),n=g.find('.user-box .user-main'),p=n.find('.user-main-info table.user-main-table'),q=p.find('tbody.user-main-tbody'),r=n.find('.user-main-nav .dept-select-list'),o=r.find('div.dept-select-wrap'),s=r.find('ul.dept-select-inner');return{onload:function onload(a){function g(a,b){if(b&&b[0]){var c=a,d=c.find('.add-form-base'),e=c.find('.add-form-extra .extra-list');c.attr('data-userid',b[0].user_id),d.find('input.username').val(b[0].name),d.find('input.usermobile').val(b[0].mobile),d.find('input.employee_num').val(b[0].employee_num),e.find('.extra-item-index input.business').val(b[0].title),e.find('.extra-item-index input.departmentId').val(b[0].department_id),e.find('.extra-item-index input.department').val(b[0].department)}}function h(a,d){var g=d.status,j=d.type,k=d.parentid,l=d.orgid,m='parent'==j?k:l;a.find('>').remove(),c.ajaxSubmit({type:'get',url:'/v1.0/org/department/'+m+'/departments',dauth:e+' '+new Date().valueOf()+' '+b.buildDauth(e,n,new Date().valueOf()),data:{},success:function success(b){var c=b.data.result;if('parent'==d.type){o.find('>').remove();var e=$('<a class="item-info select-item" href="javascript:;" data-orgid="'+d.orgid+'"><i class="iconfont item-class">&#xe608;</i><span class="text"><i class="iconfont item-class">&#xe61d;</i>'+d.orgname+'</span></a>');o.append(e),function initUsers(a,b){a.on('click',function(a){a.stopPropagation();var d=$(this);d.hasClass('current')||(r.find('.select-item').removeClass('current'),d.addClass('current'),f=b.orgid,i(q,{orgid:f,title:b.title}))})}(e,{orgid:d.orgid,title:d.orgname,type:d.type})}for(var g=0;g<b.data.result.length;g++){var j=$('<li class="select-item clear" data-orgid="'+c[g].org_id+'" data-status="onload">                                    <a class="item-info" href="javascript:;"><i class="iconfont item-class">&#xe641;</i><span class="text"><i class="iconfont item-class">&#xe661;</i>'+c[g].name+'</span></a>                                    <ul class="select-son-list clear"></ul>                                </li>');a.append(j),function bindSon(a,b){a.find('a.item-info').on('click',function(d){d.stopPropagation();var e=$(this),c=e.parent('.select-item');c.hasClass('current')||(r.find('.select-item').removeClass('current'),c.addClass('current'),f=b.orgid),f=b.orgid,'department'!=t&&i(q,{orgid:f,title:b.title}),'loaded'==c.attr('data-status')||(h(a.find('ul.select-son-list'),{status:'onload',type:'son',parentid:k,orgid:b.orgid}),c.attr('data-status','loaded'))})}(j,{orgid:c[g].id,title:c[g].name})}}})}function i(a,f,g,h){var i=g&&!0==g?'/v1.0/org'+(f.type&&'parent'==f.type?'':'/department')+'/'+f.orgid+'/users':'/v1.0/org'+(f.type&&'parent'==f.type?'':'/department')+'/'+f.orgid+'/users',j=g&&!0==g?{query:f.query}:{};a.find('>').remove(),c.ajaxSubmit({type:'get',url:i,dauth:e+' '+new Date().valueOf()+' '+b.buildDauth(e,n,new Date().valueOf()),data:j,success:function success(b){var c=b.data.result;if(d=c,c){g&&!0==g&&h&&(h.find('a.select-item, li.select-item').removeClass('current'),h.find('.dept-select-wrap a.item-info').addClass('current'));for(var e=0;e<b.data.result.length;e++){var f=$('<tr>                                    <td><a class="item" href="javascript:;" data-uid="'+c[e].user_id+'"><i class="iconfont">&#xe76a;</i></a></td>                                    <td>'+c[e].nickname+'</td>                                    <td>'+c[e].employee_num+'</td>                                    <td>'+c[e].department+'</td>                                    <td>'+c[e].title+'</td>                                    <td>'+c[e].mobile+'</td>                                </tr>');a.append(f),function selectUser(a,b){a.on('click',function(a){a.stopPropagation();var d=$(this);d.hasClass('selected')?(d.removeClass('selected').find('i').html('&#xe76a;'),d.removeClass('selected'),d.find('i').html('&#xe76a;')):(b.find('a.item.selected').removeClass('selected').find('i').html('&#xe76a;'),d.addClass('selected').find('i').html('&#xe63d;'),d.addClass('selected'),d.find('i').html('&#xe63d;'))})}(f.find('a.item'),p.find('.user-main-tbody'))}}else{a.append($('<tr><td colspan="8" class="empty"></td></tr>'))}}})}var e=c.getCookie('userid'),n=c.getCookie('token');console.log('params',a);var t=a.type,u=a.data;k.off('click').on('click',function(a){a.stopPropagation(),i(q,{type:'parent',query:j.val(),orgid:u.orgid},!0,r)}),l.off('click').on('click',function(a){a.stopPropagation(),console.log('~~~~~~~\u6DFB\u52A0\u6210\u5458');var c=[];q.find('a.item.selected').each(function(a,b){c.push(d[$(b).parents('tr').index()])}),console.log('jsonData',c),g($('#adduser .add-user .add-inner'),c),b.closePopup('finduser')}),m.off('click').on('click',function(){b.closePopup('finduser')}),h(s,{status:'onload',type:'parent',parentid:u.parentid,orgid:u.orgid,orgname:u.orgname}),i(q,{type:'parent',orgid:u.orgid,title:u.orgname})}}});