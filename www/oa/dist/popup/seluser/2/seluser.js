'use strict';define(['module','common/kernel/kernel','site/util/util'],function(a,b,c){function d(a,d,e){var f=e&&!0==e?'/v1.0/org'+(d.type&&'parent'==d.type?'':'/department')+'/'+d.orgid+'/users':'/v1.0/org'+(d.type&&'parent'==d.type?'':'/department')+'/'+d.orgid+'/users',g=e&&!0==e?{q:d.query}:{};a.find('>').remove(),c.ajaxSubmit({type:'get',url:f,dauth:d.userid+' '+new Date().valueOf()+' '+b.buildDauth(d.userid,d.token,new Date().valueOf()),data:g,success:function success(b){var c=b.data.result;if(c)for(var d=0;d<b.data.result.length;d++){var e=c[d].org_id==c[d].department_id?'':c[d].department,f=$('<tr class="main-item" data-id="'+c[d].user_id+'">                            <td><input class="main-item-radio" name="director" type="checkbox"  data-id="'+c[d].user_id+'"/></td>                            <td class="main-item-name">'+c[d].nickname+'</td>                            <td>'+c[d].employee_num+'</td>                            <td>'+e+'</td>                            <td>'+c[d].title+'</td>                            <td>'+c[d].mobile+'</td>                        </tr>');a.append(f)}else{a.append($('<tr><td colspan="8" class="empty"></td></tr>'))}}})}var e,f,g=c.getCookie('departmentid'),h=a.id.replace(/^[^/]+\/|\/[^/]+/g,''),i=$('#'+h),j=i.find('.search-form'),k=j.find('input.search'),l=j.find('a.btn-user-search'),m=i.find('.btn-edit-dept-setadmin'),n=i.find('.btn-edit-dept-cancel'),o=i.find('.user-main .user-main-innner .user-main-table .user-main-tbody');return{onload:function onload(a){e=b.parseHash(location.hash),i=e.args.type,f=e.args.key_search;var g=c.getCookie('userid'),h=c.getCookie('token');console.log('params',a);var i=a.type,j=a.data;l.off('click').on('click',function(a){a.preventDefault(),d(o,{userid:g,token:h,orgid:j.orgid,query:k.val()},!0)}),d(o,{userid:g,token:h,orgid:j.orgid}),m.off('click').on('click',function(a){a.stopPropagation();var d=[],e=[];o.find('tr.main-item td input[name="director"]:checked').each(function(a,b){d.push($(b).attr('data-id')),e.push($(b).parents('.main-item').find('.main-item-name').text())}),c.ajaxSubmit({type:'post',url:'/v1.0/org/department/'+j.orgid+'/director',dauth:g+' '+new Date().valueOf()+' '+b.buildDauth(g,h,new Date().valueOf()),data:{director_ids:d},success:function success(a){if(0==a.code){b.hint('\u8BBE\u7F6E\u90E8\u95E8\u4E3B\u7BA1\u6210\u529F',3e3),b.closePopup('seluser');var c='';$.each(e,function(a){c+=e[a]}),j.adnull&&!0==j.adnull?j.$target.html('<span class="item-admin-name">'+c+'</span>(<em>\u4E3B\u7BA1</em>)'):j.$target.removeClass('null').addClass('item-admin').html('<span class="item-admin-name">'+c+'</span>(<em>\u4E3B\u7BA1</em>)</span>')}else b.hint(a.msg,3e3)}})}),n.off('click').on('click',function(){b.closePopup('seluser')})}}});