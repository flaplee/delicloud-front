seajs.config({base:"http://static.delicloud.com/h5/app/application/",alias:{jquery:"js/jquery.js",util:"js/util.js",fastclick:"js/fastclick.js",swiper:"js/swiper.jquery.min.js"}}),seajs.use(["jquery","util","fastclick","swiper"],function(jquery,util,fastclick,swiper){deli.config({noncestr:"abcdefg",appId:"377900597703081984",timestamp:"1518056703",signature:"0c6f93a1017e6edcdf53682cd9e3ad73",jsApiList:["common.navigation.setTitle","common.navigation.setRight","common.navigation.close","common.image.upload","common.image.preview","common.location.open","common.location.get","common.message.share","common.phone.vibrate","common.connection.getNetworkType","common.phone.getUUID","common.phone.getInterface","app.device.bind","app.user.telephoneCall","app.user.chatOpen","app.user.select","app.department.select"]});var Page={init:function(){var a=this;FastClick.attach(document.body),a.bindEvt()},bindEvt:function(){function setScreenShot(a){var b=$("#app_screenshot");a.join(",").split(",").map(function(a,c){b.append($('<div class="screenshot app_screenshot" data-index="'+c+'"><img width="131" class="lazyload lazyload-fadein" data-src="'+a+'" src="'+a+'"></div>'))}),b.on("click",".app_screenshot",function(){var b=$(this),c=parseInt(b.attr("data-index"));deli.common.image.preview({current:c,urls:a},function(){},function(){})})}var app_name,belong_type,app_url,getInitData,self=this,token=util.getQuery("token"),appid=util.getQuery("appid"),orgid=util.getQuery("orgid"),userid=util.getQuery("userid"),orgHtml="",$page=$("#page"),$detail=$page.find(".content > .appdetail"),$detailItem=$detail.find(".appdetail-item"),$detailItemIcon=$detailItem.find(".appdetail-icon"),$detailItemInfo=$detailItem.find(".appdetail-info"),$detailBannerInner=$detail.find(".appdetail-banner .appdetail-device .appdetail-device-inner"),$detailIntroduce=$detail.find(".appdetail-introduce"),$introduceCont=$detailIntroduce.find(".introduce-content"),$introduceMore=$introduceCont.find(".introduce-more"),$detailBase=$detail.find(".appdetail-base"),$detailBaseList=$detailBase.find(".base-device-list"),$detailBtns=$page.find(".navmenu > .btns"),$btnAdd=$detailBtns.find(".btn-add"),$btnAdded=$detailBtns.find(".btn-added"),$btnSwitch=$detailBtns.find(".btn-switch"),$btnRelated=$detailBtns.find(".btn-related"),sentAppBind=function(a,b,c,d,e,f,g){$.ajax({type:"get",url:"http://web.delicloud.com/v1.0/cd/bind?Dauth="+a+" "+(new Date).valueOf()+" "+util.buildHash(g),headers:{Dauth:a+" "+(new Date).valueOf()+" "+util.buildHash(g)},data:{org_id:b,app_id:d},contentType:"application/json; charset=utf-8",dataType:"jsonp",jsonp:"callback",success:function(a){0==a.code&&0!=a.data["result"]?(deli.common.notification.toast({text:"应用添加成功~",duration:3},function(){},function(){}),setTimeout(function(){a.data,deli.app.method.transit({id:d,org_id:b,name:e||"",org_name:c||"",app_url:f||""},function(){},function(){})},1500)):deli.common.notification.toast({text:a.msg,duration:3},function(){},function(){})},error:function(a){4==a.readyState&&200==a.status&&deli.common.notification.toast({text:"网络错误，请重试~",duration:2},function(){},function(){})}})};$btnAdd.on("click",function(){deli.app.organization.select({type:belong_type},function(a){var b,c;b=a.id,c=a.name,sentAppBind(userid,b,c,appid,app_name,app_url,token)},function(){})}),getInitData=function(id){$.ajax({type:"get",url:"http://web.delicloud.com/v1.0/cd/app/"+id+"?Dauth="+userid+" "+(new Date).valueOf()+" "+util.buildHash(token),dataType:"jsonp",jsonp:"callback",success:function(res){var data,innerHTML,deviceHtml,i,urls,screen_shot1,screen_shot2,screen_shot3,screen_shot4,screen_shot5,item_shot,$targetHtml,itemHtml;if(0==res.code){switch(data=res.data["result"],innerHTML="",deviceHtml="",app_name=data.name,$detailItemIcon.find("img").attr("src",data.icon),$detailItemInfo.find(".appdetail-title").text(app_name),$detailItemInfo.find(".appdetail-content").text(data.slogan),data.description?(data.description.length>=200&&($introduceMore.show(),$introduceMore.on("click",function(){$(this),$introduceCont.find("p.content-inner").css({overflow:"hidden",height:"auto","white-space":"pre-wrap"}),$introduceMore.hide()})),$introduceCont.find("p.content-inner").html(data.description)):$introduceMore.hide(),app_url=data.app_url,belong_type=data.belong_type){case"group":innerHTML='<span class="appdetail-category-name">企业可用</span>';break;case"user":innerHTML='<span class="appdetail-category-name">个人可用</span>';break;case"both":innerHTML='<span class="appdetail-category-name">企业可用</span><span class="appdetail-category-name">个人可用</span>'}for($detailItemInfo.find(".appdetail-category").html(innerHTML),i=1,urls=[],screen_shot1=data.screen_shot1,screen_shot2=data.screen_shot2,screen_shot3=data.screen_shot3,screen_shot4=data.screen_shot4,screen_shot5=data.screen_shot5;5>=i;)item_shot=eval("screen_shot"+i),item_shot&&""!=item_shot&&urls.push(item_shot),i++;if(setScreenShot(urls),data.products&&data.products.length>0){for(itemHtml="",$detailBase.show(),i=0;1>i;i++)itemHtml+='<a class="base-device" href="javascript:;"><div class="device-icon"><img src="'+data.products[i].icon+'" /></div><div class="device-title">'+data.products[i].name+"</div></a>";$detailBaseList.append($(itemHtml))}else $detailIntroduce.css({"margin-bottom":"65px"}),$introduceCont.find("p.content-inner").css({height:"auto"}),$introduceMore.hide(),$detailBase.hide()}else util.hint(res.msg)}})},getInitData(appid),$detailBtns.find("a").css("display","none")&&$detailBtns.find("a.btn-add").css("display","block")}};deli.ready(function(){Page.init()}),deli.error(function(){})});